<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë°€ ë§Œì„¸ë ¥ PRO (ë””ë²„ê¹… ì™„ë£Œ)</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.min.js"></script>
    <style>
        /* ë””ìì¸ ì˜ì—­ */
        body { font-family: 'Pretendard', 'Malgun Gothic', sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; border-bottom: 2px solid #2980b9; padding-bottom: 15px; margin-bottom: 20px; color: #2c3e50; }
        
        .form-group { margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        .form-group label { font-weight: bold; width: 30%; }
        .form-group input, .form-group select { width: 65%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; }
        
        button { width: 100%; padding: 15px; background: #2980b9; color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        button:hover { background: #1c5980; }

        /* ê²°ê³¼ì°½ */
        #resultArea { display: none; margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        .saju-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; text-align: center; margin-bottom: 20px; }
        .pillar { background: #f9f9f9; padding: 10px 5px; border-radius: 8px; border: 1px solid #eee; }
        .gan, .ji { font-size: 26px; font-weight: 900; display: block; margin: 5px 0; font-family: serif; }

        /* ì˜¤í–‰ ìƒ‰ìƒ */
        .wood { color: #0040FF !important; } .fire { color: #FF0000 !important; }
        .earth { color: #E6B800 !important; } .metal { color: #666666 !important; }
        .water { color: #000000 !important; }

        /* ëŒ€ìš´ ë¦¬ìŠ¤íŠ¸ */
        .daeun-scroll { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; }
        .daeun-card { min-width: 60px; background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 6px; text-align: center; flex-shrink: 0; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ”® ì •ë°€ ë§Œì„¸ë ¥ PRO</h1>
        
        <div class="form-group">
            <label>ì´ë¦„</label>
            <input type="text" id="name" placeholder="ì´ë¦„ ì…ë ¥" value="ì‚¬ìš©ì">
        </div>
        <div class="form-group">
            <label>ì„±ë³„</label>
            <select id="gender">
                <option value="ë‚¨">ë‚¨ì (Male)</option>
                <option value="ì—¬">ì—¬ì (Female)</option>
            </select>
        </div>
        <div class="form-group">
            <label>ìƒë…„ì›”ì¼</label>
            <input type="number" id="bDate" placeholder="19941007" value="">
        </div>
        <div class="form-group">
            <label>ì¶œìƒì‹œê°„</label>
            <input type="number" id="bTime" placeholder="1430" value="">
        </div>
        <div class="form-group">
            <label>ì¶œìƒì§€ì—­</label>
            <select id="location">
                <option value="">ë°ì´í„° ë¡œë”© ì¤‘...</option>
            </select>
        </div>

        <button onclick="calculateSaju()">ë‚´ ì‚¬ì£¼ í™•ì¸í•˜ê¸°</button>

        <div id="resultArea">
            <div class="saju-grid">
                <div class="pillar"><span>ì‹œì£¼</span><span id="siGan" class="gan"></span><span id="siJi" class="ji"></span></div>
                <div class="pillar"><span>ì¼ì£¼</span><span id="ilGan" class="gan"></span><span id="ilJi" class="ji"></span></div>
                <div class="pillar"><span>ì›”ì£¼</span><span id="wolGan" class="gan"></span><span id="wolJi" class="ji"></span></div>
                <div class="pillar"><span>ì—°ì£¼</span><span id="yeonGan" class="gan"></span><span id="yeonJi" class="ji"></span></div>
            </div>
            
            <div style="background:#f4f4f4; padding:15px; border-radius:8px;">
                <div id="daeunInfo" style="font-weight:bold; margin-bottom:10px;"></div>
                <div id="daeunList" class="daeun-scroll"></div>
            </div>
            
            <div id="seunInfo" style="margin-top:15px; padding:10px; background:#eef; border-radius:8px;"></div>
        </div>
    </div>

    <script>
        // 1. 163ê°œ ì§€ì—­ ë°ì´í„° (ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ ì „ì—­ë³€ìˆ˜ë¡œ ì„ ì–¸)
        const LOCATIONS = [
            {name: "ì„œìš¸", lon: 126.9783}, {name: "ë¶€ì‚°", lon: 129.0750}, {name: "ëŒ€êµ¬", lon: 128.6025}, {name: "ì¸ì²œ", lon: 126.7052}, 
            {name: "ê´‘ì£¼(ì „ë¼)", lon: 126.8515}, {name: "ëŒ€ì „", lon: 127.3845}, {name: "ìš¸ì‚°", lon: 129.3114}, {name: "ì„¸ì¢…", lon: 127.2892}, 
            {name: "ê²½ê¸°ê´‘ì£¼", lon: 127.2554}, {name: "ìˆ˜ì›", lon: 127.0286}, {name: "ì„±ë‚¨", lon: 127.1389}, {name: "ì˜ì •ë¶€", lon: 127.0338}, 
            {name: "ì•ˆì–‘", lon: 126.9568}, {name: "ë¶€ì²œ", lon: 126.7660}, {name: "ê´‘ëª…", lon: 126.8646}, {name: "í‰íƒ", lon: 127.1129}, 
            {name: "ë™ë‘ì²œ", lon: 127.0607}, {name: "ì•ˆì‚°", lon: 126.8308}, {name: "ê³ ì–‘", lon: 126.8317}, {name: "ê³¼ì²œ", lon: 126.9896}, 
            {name: "êµ¬ë¦¬", lon: 127.1438}, {name: "ë‚¨ì–‘ì£¼", lon: 127.2185}, {name: "ì˜¤ì‚°", lon: 127.0776}, {name: "ì‹œí¥", lon: 126.8031}, 
            {name: "êµ°í¬", lon: 126.9351}, {name: "ì˜ì™•", lon: 126.9740}, {name: "í•˜ë‚¨", lon: 127.2142}, {name: "ìš©ì¸", lon: 127.1775}, 
            {name: "íŒŒì£¼", lon: 126.7846}, {name: "ì´ì²œ", lon: 127.4387}, {name: "ì•ˆì„±", lon: 127.2792}, {name: "ê¹€í¬", lon: 126.7157}, 
            {name: "í™”ì„±", lon: 126.8315}, {name: "ì–‘ì£¼", lon: 127.0459}, {name: "í¬ì²œ", lon: 127.2003}, {name: "ì—¬ì£¼", lon: 127.6373}, 
            {name: "ì—°ì²œ", lon: 127.0749}, {name: "ê°€í‰", lon: 127.5109}, {name: "ì–‘í‰", lon: 127.4872}, {name: "ì¶˜ì²œ", lon: 127.7298}, 
            {name: "ì›ì£¼", lon: 127.9515}, {name: "ê°•ë¦‰", lon: 128.8759}, {name: "ë™í•´", lon: 129.1147}, {name: "íƒœë°±", lon: 128.9858}, 
            {name: "ì†ì´ˆ", lon: 128.5918}, {name: "ì‚¼ì²™", lon: 129.1651}, {name: "í™ì²œ", lon: 127.8887}, {name: "íš¡ì„±", lon: 127.9850}, 
            {name: "ì˜ì›”", lon: 128.4651}, {name: "í‰ì°½", lon: 128.3962}, {name: "ì •ì„ ", lon: 128.6608}, {name: "ì² ì›", lon: 127.3115}, 
            {name: "í™”ì²œ", lon: 127.7083}, {name: "ì–‘êµ¬", lon: 127.9904}, {name: "ì¸ì œ", lon: 128.1704}, {name: "ê³ ì„±(ê°•ì›)", lon: 128.4678}, 
            {name: "ì–‘ì–‘", lon: 128.6186}, {name: "ì²­ì£¼", lon: 127.4897}, {name: "ì¶©ì£¼", lon: 127.9287}, {name: "ì œì²œ", lon: 128.2104}, 
            {name: "ë³´ì€", lon: 127.7291}, {name: "ì˜¥ì²œ", lon: 127.5692}, {name: "ì˜ë™", lon: 127.7830}, {name: "ì§„ì²œ", lon: 127.4357}, 
            {name: "ê´´ì‚°", lon: 127.7923}, {name: "ìŒì„±", lon: 127.6905}, {name: "ë‹¨ì–‘", lon: 128.3722}, {name: "ì¦í‰", lon: 127.5815}, 
            {name: "ì²œì•ˆ", lon: 127.1139}, {name: "ê³µì£¼", lon: 127.1247}, {name: "ë³´ë ¹", lon: 126.5985}, {name: "ì•„ì‚°", lon: 127.0016}, 
            {name: "ì„œì‚°", lon: 126.4503}, {name: "ë…¼ì‚°", lon: 127.0847}, {name: "ê³„ë£¡", lon: 127.2526}, {name: "ë‹¹ì§„", lon: 126.6290}, 
            {name: "ê¸ˆì‚°", lon: 127.4883}, {name: "ë¶€ì—¬", lon: 126.9097}, {name: "ì„œì²œ", lon: 126.6908}, {name: "ì²­ì–‘", lon: 126.8000}, 
            {name: "í™ì„±", lon: 126.6629}, {name: "ì˜ˆì‚°", lon: 126.8453}, {name: "íƒœì•ˆ", lon: 126.2925}, {name: "ì „ì£¼", lon: 127.1480}, 
            {name: "êµ°ì‚°", lon: 126.7360}, {name: "ìµì‚°", lon: 126.9575}, {name: "ì •ì", lon: 126.8564}, {name: "ë‚¨ì›", lon: 127.3905}, 
            {name: "ê¹€ì œ", lon: 126.8809}, {name: "ì™„ì£¼", lon: 127.1627}, {name: "ì§„ì•ˆ", lon: 127.4258}, {name: "ë¬´ì£¼", lon: 127.6608}, 
            {name: "ì¥ìˆ˜", lon: 127.5211}, {name: "ì„ì‹¤", lon: 127.2889}, {name: "ìˆœì°½", lon: 127.1444}, {name: "ê³ ì°½", lon: 126.7021}, 
            {name: "ë¶€ì•ˆ", lon: 126.7330}, {name: "ëª©í¬", lon: 126.3922}, {name: "ì—¬ìˆ˜", lon: 127.6623}, {name: "ìˆœì²œ", lon: 127.4875}, 
            {name: "ë‚˜ì£¼", lon: 126.7160}, {name: "ê´‘ì–‘", lon: 127.6959}, {name: "ë‹´ì–‘", lon: 126.9912}, {name: "ê³¡ì„±", lon: 127.2917}, 
            {name: "êµ¬ë¡€", lon: 127.4627}, {name: "ê³ í¥", lon: 127.2849}, {name: "ë³´ì„±", lon: 127.1702}, {name: "í™”ìˆœ", lon: 126.9880}, 
            {name: "ì¥í¥", lon: 126.9073}, {name: "ê°•ì§„", lon: 126.7699}, {name: "í•´ë‚¨", lon: 126.6022}, {name: "ì˜ì•”", lon: 126.4631}, 
            {name: "ë¬´ì•ˆ", lon: 126.4817}, {name: "í•¨í‰", lon: 126.5167}, {name: "ì˜ê´‘", lon: 126.5120}, {name: "ì¥ì„±", lon: 126.7850}, 
            {name: "ì™„ë„", lon: 126.7226}, {name: "ì§„ë„", lon: 126.2635}, {name: "ì‹ ì•ˆ", lon: 126.1105}, {name: "í¬í•­", lon: 129.3435}, 
            {name: "ê²½ì£¼", lon: 129.2247}, {name: "ê¹€ì²œ", lon: 128.1189}, {name: "ì•ˆë™", lon: 128.7297}, {name: "êµ¬ë¯¸", lon: 128.3510}, 
            {name: "ì˜ì£¼", lon: 128.6250}, {name: "ì˜ì²œ", lon: 128.9385}, {name: "ìƒì£¼", lon: 128.1591}, {name: "ë¬¸ê²½", lon: 128.1993}, 
            {name: "ê²½ì‚°", lon: 128.7540}, {name: "êµ°ìœ„", lon: 128.5728}, {name: "ì˜ì„±", lon: 128.6974}, {name: "ì²­ì†¡", lon: 129.0572}, 
            {name: "ì˜ì–‘", lon: 129.1148}, {name: "ì˜ë•", lon: 129.3653}, {name: "ì²­ë„", lon: 128.7340}, {name: "ê³ ë ¹", lon: 128.2632}, 
            {name: "ì„±ì£¼", lon: 128.2854}, {name: "ì¹ ê³¡", lon: 128.4067}, {name: "ì˜ˆì²œ", lon: 128.5170}, {name: "ë´‰í™”", lon: 128.7351}, 
            {name: "ìš¸ì§„", lon: 129.4013}, {name: "ìš¸ë¦‰", lon: 130.9060}, {name: "ë…ë„", lon: 131.8696}, {name: "ì°½ì›", lon: 128.6811}, 
            {name: "ì§„ì£¼", lon: 128.0848}, {name: "í†µì˜", lon: 128.4285}, {name: "ì‚¬ì²œ", lon: 128.0707}, {name: "ê¹€í•´", lon: 128.8893}, 
            {name: "ë°€ì–‘", lon: 128.7483}, {name: "ê±°ì œ", lon: 128.6211}, {name: "ì–‘ì‚°", lon: 129.0373}, {name: "ì˜ë ¹", lon: 128.2618}, 
            {name: "í•¨ì•ˆ", lon: 128.4065}, {name: "ì°½ë…•", lon: 128.4921}, {name: "ê³ ì„±(ê²½ë‚¨)", lon: 128.3220}, {name: "ë‚¨í•´", lon: 127.8926}, 
            {name: "í•˜ë™", lon: 127.7515}, {name: "ì‚°ì²­", lon: 127.8735}, {name: "í•¨ì–‘", lon: 127.7252}, {name: "ê±°ì°½", lon: 127.9095}, 
            {name: "í•©ì²œ", lon: 128.1658}, {name: "ì œì£¼", lon: 126.5312}, {name: "ì„œê·€í¬", lon: 126.5601}
        ];

        // 2. ì´ˆê¸° ë¡œë”© ì‹œ ì§€ì—­ ëª©ë¡ ì±„ìš°ê¸°
        window.onload = function() {
            // ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì²´í¬
            if(typeof Solar === 'undefined') {
                alert("âš ï¸ ê³„ì‚° ë„êµ¬(Lunar.js) ë¡œë“œ ì‹¤íŒ¨!\nì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ìƒˆë¡œê³ ì¹¨ í•˜ì„¸ìš”.");
                return;
            }
            
            const sel = document.getElementById('location');
            sel.innerHTML = '<option value="">ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            LOCATIONS.sort((a, b) => a.name.localeCompare(b.name));
            LOCATIONS.forEach((loc, idx) => {
                let opt = document.createElement('option');
                opt.value = idx; 
                opt.text = loc.name;
                sel.add(opt);
            });
        };

        // 3. ê· ì‹œì°¨(EOT) ê³µì‹
        function getEquationOfTime(date) {
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = date - start;
            const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
            const B = (2 * Math.PI / 365) * (dayOfYear - 81);
            return 9.87 * Math.sin(2 * B) - 7.53 * Math.cos(B) - 1.5 * Math.sin(B);
        }

        // 4. ì˜¤í–‰ ìƒ‰ìƒ
        function getElementClass(char) {
            if("ç”²ä¹™å¯…å¯".includes(char)) return "wood";
            if("ä¸™ä¸å·³åˆ".includes(char)) return "fire";
            if("æˆŠå·±è¾°æˆŒä¸‘æœª".includes(char)) return "earth";
            if("åºšè¾›ç”³é…‰".includes(char)) return "metal";
            if("å£¬ç™¸äº¥å­".includes(char)) return "water";
            return "";
        }

        // 5. ê³„ì‚° í•¨ìˆ˜ (ì—ëŸ¬ ë°©ì§€ ë¡œì§ ê°•í™”)
        function calculateSaju() {
            try {
                // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
                const bDate = document.getElementById('bDate').value;
                const bTime = document.getElementById('bTime').value;
                const locIdx = document.getElementById('location').value;
                const gender = document.getElementById('gender').value;

                // [ì¤‘ìš”] ìœ íš¨ì„± ê²€ì‚¬
                if(!bDate || bDate.length !== 8) return alert("ìƒë…„ì›”ì¼ 8ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
                if(!bTime || bTime.length !== 4) return alert("ì¶œìƒì‹œê°„ 4ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
                if(locIdx === "") return alert("ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”");

                const year = parseInt(bDate.substring(0, 4));
                const month = parseInt(bDate.substring(4, 6));
                const day = parseInt(bDate.substring(6, 8));
                const hour = parseInt(bTime.substring(0, 2));
                const minute = parseInt(bTime.substring(2, 4));

                // ------------------------------------------------
                // [ì§„íƒœì–‘ì‹œ ë³´ì •]
                // 1. ì§€ì—­ ì¢Œí‘œ ì°¾ê¸° (ì „ì—­ë³€ìˆ˜ ë°°ì—´ì—ì„œ ì•ˆì „í•˜ê²Œ ì¡°íšŒ)
                const realLoc = LOCATIONS[locIdx];
                if (!realLoc) throw new Error("ì§€ì—­ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

                const lonOffset = (realLoc.lon - 135) * 4;
                
                // 2. ê· ì‹œì°¨ ê³„ì‚°
                const baseDate = new Date(year, month - 1, day, hour, minute);
                if (isNaN(baseDate.getTime())) throw new Error("ë‚ ì§œ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.");
                
                const eotOffset = getEquationOfTime(baseDate);

                // 3. ìµœì¢… ë³´ì • ì‹œê°„
                let adjDate = new Date(baseDate.getTime());
                adjDate.setMinutes(adjDate.getMinutes() + lonOffset + eotOffset);
                // ------------------------------------------------

                // [ì‚¬ì£¼ ê³„ì‚°]
                const lunar = Lunar.fromDate(adjDate);
                const baZi = lunar.getEightChar();
                
                // [í™”ë©´ ì¶œë ¥]
                const setCell = (idG, idJ, gan, ji) => {
                    const elG = document.getElementById(idG);
                    const elJ = document.getElementById(idJ);
                    elG.innerText = gan; elG.className = "gan " + getElementClass(gan);
                    elJ.innerText = ji; elJ.className = "ji " + getElementClass(ji);
                };

                setCell('siGan', 'siJi', baZi.getTimeGan(), baZi.getTimeZhi());
                setCell('ilGan', 'ilJi', baZi.getDayGan(), baZi.getDayZhi());
                setCell('wolGan', 'wolJi', baZi.getMonthGan(), baZi.getMonthZhi());
                setCell('yeonGan', 'yeonJi', baZi.getYearGan(), baZi.getYearZhi());

                // [yun ì—ëŸ¬ ë°©ì§€ êµ¬ì—­]
                // gender ê°’ì„ ìˆ«ì(1=ë‚¨, 0=ì—¬)ë¡œ ëª…í™•í•˜ê²Œ ë³€í™˜
                const genderNum = (gender === "ë‚¨") ? 1 : 0;
                
                // baZi ê°ì²´ê°€ ì •ìƒì¸ì§€ í™•ì¸ í›„ í˜¸ì¶œ
                if (baZi) {
                    const yun = baZi.getYun(genderNum); // ì—¬ê¸°ì„œ ì—ëŸ¬ê°€ ë‚¬ì—ˆìŒ
                    const dirStr = yun.getGender() === 1 ? "ìˆœí–‰" : "ì—­í–‰";

                    document.getElementById('daeunInfo').innerHTML = 
                        `<span style="color:#2980b9;">${yun.getStartAge()}</span>ì„¸ ëŒ€ìš´ (${dirStr})`;

                    const listDiv = document.getElementById('daeunList');
                    listDiv.innerHTML = "";
                    
                    yun.getDaYun().forEach((dy, i) => {
                        if(i >= 10) return;
                        const gan = dy.getGanZhi()[0];
                        const ji = dy.getGanZhi()[1];
                        const div = document.createElement('div');
                        div.className = "daeun-card";
                        div.innerHTML = `<div class="daeun-age">${dy.getStartAge()}ì„¸</div><div><span class="${getElementClass(gan)}" style="font-size:18px; font-weight:bold;">${gan}</span><br><span class="${getElementClass(ji)}" style="font-size:18px; font-weight:bold;">${ji}</span></div>`;
                        listDiv.appendChild(div);
                    });
                }

                // [ì„¸ìš´]
                const thisYearLunar = Lunar.fromDate(new Date());
                const tyGan = thisYearLunar.getYearGan();
                const tyJi = thisYearLunar.getYearZhi();
                document.getElementById('seunInfo').innerHTML = `ì˜¬í•´ëŠ” <b>${tyGan}${tyJi}</b>ë…„ ì…ë‹ˆë‹¤.`;

                document.getElementById('resultArea').style.display = 'block';

            } catch (e) {
                console.error(e);
                alert("ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + e.message);
            }
        }
    </script>
</body>
</html>