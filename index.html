<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë°€ ë§Œì„¸ë ¥ PRO (í†µí•©ë³¸)</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <style>
        /* [ë””ìì¸ ì˜ì—­] */
        body { font-family: 'Pretendard', 'Malgun Gothic', sans-serif; background-color: #f0f2f5; padding: 20px; margin: 0; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        h1 { text-align: center; margin-bottom: 25px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 15px; font-size: 22px; }
        
        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .form-group { margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        .form-group label { font-weight: bold; color: #555; width: 30%; font-size: 15px; }
        .form-group input, .form-group select { width: 68%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .form-group input:focus, .form-group select:focus { border-color: #3498db; outline: none; }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button { width: 100%; padding: 15px; background-color: #34495e; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 15px; transition: 0.2s; }
        button:hover { background-color: #2c3e50; transform: translateY(-2px); }

        /* ê²°ê³¼ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #resultArea { display: none; margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        
        .saju-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; text-align: center; margin-bottom: 25px; }
        .pillar { background: #f8f9fa; padding: 10px 2px; border-radius: 8px; border: 1px solid #e9ecef; }
        .pillar-head { font-size: 13px; color: #7f8c8d; margin-bottom: 8px; }
        .gan, .ji { font-size: 26px; font-weight: 900; display: block; margin: 4px 0; font-family: serif; }

        /* ì˜¤í–‰ ìƒ‰ìƒ (ì‚¬ìš©ì ì§€ì •: ëª©=íŒŒë€ìƒ‰) */
        .wood { color: #0040FF !important; }  
        .fire { color: #FF0000 !important; }  
        .earth { color: #E6B800 !important; } 
        .metal { color: #666666 !important; } 
        .water { color: #000000 !important; } 

        /* ëŒ€ìš´ & ì„¸ìš´ ë°•ìŠ¤ */
        .info-box { background: #fff; border: 1px solid #dfe6e9; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .info-title { font-weight: bold; font-size: 16px; margin-bottom: 10px; color: #2d3436; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        .daeun-scroll { display: flex; overflow-x: auto; gap: 8px; padding-bottom: 5px; }
        .daeun-card { min-width: 50px; background: #fdfdfd; border: 1px solid #eee; border-radius: 6px; padding: 8px; text-align: center; flex-shrink: 0; }
        .daeun-age { font-size: 12px; color: #999; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ”® ì •ë°€ ë§Œì„¸ë ¥ PRO (í†µí•©ë³¸)</h1>
        
        <div class="form-group">
            <label>ì´ë¦„</label>
            <input type="text" id="name" placeholder="í™ê¸¸ë™">
        </div>
        <div class="form-group">
            <label>ì„±ë³„</label>
            <select id="gender">
                <option value="ë‚¨">ë‚¨ì (Male)</option>
                <option value="ì—¬">ì—¬ì (Female)</option>
            </select>
        </div>
        <div class="form-group">
            <label>ìƒë…„ì›”ì¼</label>
            <input type="number" id="bDate" placeholder="19941007 (8ìë¦¬)">
        </div>
        <div class="form-group">
            <label>ì¶œìƒì‹œê°„</label>
            <input type="number" id="bTime" placeholder="1430 (4ìë¦¬)">
        </div>
        <div class="form-group">
            <label>ì¶œìƒì§€ì—­</label>
            <select id="location">
                <option value="">ë°ì´í„° ë¡œë”©ì¤‘...</option>
            </select>
        </div>

        <button onclick="calculateSaju()">ë§Œì„¸ë ¥ í™•ì¸í•˜ê¸°</button>

        <div id="resultArea">
            <div class="saju-grid">
                <div class="pillar">
                    <div class="pillar-head">ì‹œì£¼ (Time)</div>
                    <span id="siGan" class="gan">-</span>
                    <span id="siJi" class="ji">-</span>
                </div>
                <div class="pillar">
                    <div class="pillar-head">ì¼ì£¼ (Day)</div>
                    <span id="ilGan" class="gan">-</span>
                    <span id="ilJi" class="ji">-</span>
                </div>
                <div class="pillar">
                    <div class="pillar-head">ì›”ì£¼ (Month)</div>
                    <span id="wolGan" class="gan">-</span>
                    <span id="wolJi" class="ji">-</span>
                </div>
                <div class="pillar">
                    <div class="pillar-head">ì—°ì£¼ (Year)</div>
                    <span id="yeonGan" class="gan">-</span>
                    <span id="yeonJi" class="ji">-</span>
                </div>
            </div>

            <div class="info-box">
                <div class="info-title">ğŸ“… ëŒ€ìš´(å¤§é‹) íë¦„</div>
                <div id="daeunInfo" style="font-size:14px; margin-bottom:8px;"></div>
                <div id="daeunList" class="daeun-scroll"></div>
            </div>

            <div class="info-box">
                <div class="info-title">ğŸš€ ì„¸ìš´(æ­²é‹)</div>
                <div id="seunInfo" style="font-size:15px; line-height:1.4;"></div>
            </div>
            
            <div style="text-align:center; font-size:11px; color:#aaa; margin-top:20px;">
                * ì§„íƒœì–‘ì‹œ(ê· ì‹œì°¨+ê²½ë„) ì •ë°€ ë³´ì • ì ìš© ì™„ë£Œ
            </div>
        </div>
    </div>

    <script>
        // 1. 163ê°œ ì§€ì—­ ë°ì´í„° (ì—‘ì…€ ì™„ë²½ ë°˜ì˜)
        const LOCATIONS = [
            {name: "ì„œìš¸", lon: 126.9783}, {name: "ë¶€ì‚°", lon: 129.0750}, {name: "ëŒ€êµ¬", lon: 128.6025}, {name: "ì¸ì²œ", lon: 126.7052}, 
            {name: "ê´‘ì£¼(ì „ë¼)", lon: 126.8515}, {name: "ëŒ€ì „", lon: 127.3845}, {name: "ìš¸ì‚°", lon: 129.3114}, {name: "ì„¸ì¢…", lon: 127.2892}, 
            {name: "ê²½ê¸°ê´‘ì£¼", lon: 127.2554}, {name: "ìˆ˜ì›", lon: 127.0286}, {name: "ì„±ë‚¨", lon: 127.1389}, {name: "ì˜ì •ë¶€", lon: 127.0338}, 
            {name: "ì•ˆì–‘", lon: 126.9568}, {name: "ë¶€ì²œ", lon: 126.7660}, {name: "ê´‘ëª…", lon: 126.8646}, {name: "í‰íƒ", lon: 127.1129}, 
            {name: "ë™ë‘ì²œ", lon: 127.0607}, {name: "ì•ˆì‚°", lon: 126.8308}, {name: "ê³ ì–‘", lon: 126.8317}, {name: "ê³¼ì²œ", lon: 126.9896}, 
            {name: "êµ¬ë¦¬", lon: 127.1438}, {name: "ë‚¨ì–‘ì£¼", lon: 127.2185}, {name: "ì˜¤ì‚°", lon: 127.0776}, {name: "ì‹œí¥", lon: 126.8031}, 
            {name: "êµ°í¬", lon: 126.9351}, {name: "ì˜ì™•", lon: 126.9740}, {name: "í•˜ë‚¨", lon: 127.2142}, {name: "ìš©ì¸", lon: 127.1775}, 
            {name: "íŒŒì£¼", lon: 126.7846}, {name: "ì´ì²œ", lon: 127.4387}, {name: "ì•ˆì„±", lon: 127.2792}, {name: "ê¹€í¬", lon: 126.7157}, 
            {name: "í™”ì„±", lon: 126.8315}, {name: "ì–‘ì£¼", lon: 127.0459}, {name: "í¬ì²œ", lon: 127.2003}, {name: "ì—¬ì£¼", lon: 127.6373}, 
            {name: "ì—°ì²œ", lon: 127.0749}, {name: "ê°€í‰", lon: 127.5109}, {name: "ì–‘í‰", lon: 127.4872}, {name: "ì¶˜ì²œ", lon: 127.7298}, 
            {name: "ì›ì£¼", lon: 127.9515}, {name: "ê°•ë¦‰", lon: 128.8759}, {name: "ë™í•´", lon: 129.1147}, {name: "íƒœë°±", lon: 128.9858}, 
            {name: "ì†ì´ˆ", lon: 128.5918}, {name: "ì‚¼ì²™", lon: 129.1651}, {name: "í™ì²œ", lon: 127.8887}, {name: "íš¡ì„±", lon: 127.9850}, 
            {name: "ì˜ì›”", lon: 128.4651}, {name: "í‰ì°½", lon: 128.3962}, {name: "ì •ì„ ", lon: 128.6608}, {name: "ì² ì›", lon: 127.3115}, 
            {name: "í™”ì²œ", lon: 127.7083}, {name: "ì–‘êµ¬", lon: 127.9904}, {name: "ì¸ì œ", lon: 128.1704}, {name: "ê³ ì„±(ê°•ì›)", lon: 128.4678}, 
            {name: "ì–‘ì–‘", lon: 128.6186}, {name: "ì²­ì£¼", lon: 127.4897}, {name: "ì¶©ì£¼", lon: 127.9287}, {name: "ì œì²œ", lon: 128.2104}, 
            {name: "ë³´ì€", lon: 127.7291}, {name: "ì˜¥ì²œ", lon: 127.5692}, {name: "ì˜ë™", lon: 127.7830}, {name: "ì§„ì²œ", lon: 127.4357}, 
            {name: "ê´´ì‚°", lon: 127.7923}, {name: "ìŒì„±", lon: 127.6905}, {name: "ë‹¨ì–‘", lon: 128.3722}, {name: "ì¦í‰", lon: 127.5815}, 
            {name: "ì²œì•ˆ", lon: 127.1139}, {name: "ê³µì£¼", lon: 127.1247}, {name: "ë³´ë ¹", lon: 126.5985}, {name: "ì•„ì‚°", lon: 127.0016}, 
            {name: "ì„œì‚°", lon: 126.4503}, {name: "ë…¼ì‚°", lon: 127.0847}, {name: "ê³„ë£¡", lon: 127.2526}, {name: "ë‹¹ì§„", lon: 126.6290}, 
            {name: "ê¸ˆì‚°", lon: 127.4883}, {name: "ë¶€ì—¬", lon: 126.9097}, {name: "ì„œì²œ", lon: 126.6908}, {name: "ì²­ì–‘", lon: 126.8000}, 
            {name: "í™ì„±", lon: 126.6629}, {name: "ì˜ˆì‚°", lon: 126.8453}, {name: "íƒœì•ˆ", lon: 126.2925}, {name: "ì „ì£¼", lon: 127.1480}, 
            {name: "êµ°ì‚°", lon: 126.7360}, {name: "ìµì‚°", lon: 126.9575}, {name: "ì •ì", lon: 126.8564}, {name: "ë‚¨ì›", lon: 127.3905}, 
            {name: "ê¹€ì œ", lon: 126.8809}, {name: "ì™„ì£¼", lon: 127.1627}, {name: "ì§„ì•ˆ", lon: 127.4258}, {name: "ë¬´ì£¼", lon: 127.6608}, 
            {name: "ì¥ìˆ˜", lon: 127.5211}, {name: "ì„ì‹¤", lon: 127.2889}, {name: "ìˆœì°½", lon: 127.1444}, {name: "ê³ ì°½", lon: 126.7021}, 
            {name: "ë¶€ì•ˆ", lon: 126.7330}, {name: "ëª©í¬", lon: 126.3922}, {name: "ì—¬ìˆ˜", lon: 127.6623}, {name: "ìˆœì²œ", lon: 127.4875}, 
            {name: "ë‚˜ì£¼", lon: 126.7160}, {name: "ê´‘ì–‘", lon: 127.6959}, {name: "ë‹´ì–‘", lon: 126.9912}, {name: "ê³¡ì„±", lon: 127.2917}, 
            {name: "êµ¬ë¡€", lon: 127.4627}, {name: "ê³ í¥", lon: 127.2849}, {name: "ë³´ì„±", lon: 127.1702}, {name: "í™”ìˆœ", lon: 126.9880}, 
            {name: "ì¥í¥", lon: 126.9073}, {name: "ê°•ì§„", lon: 126.7699}, {name: "í•´ë‚¨", lon: 126.6022}, {name: "ì˜ì•”", lon: 126.4631}, 
            {name: "ë¬´ì•ˆ", lon: 126.4817}, {name: "í•¨í‰", lon: 126.5167}, {name: "ì˜ê´‘", lon: 126.5120}, {name: "ì¥ì„±", lon: 126.7850}, 
            {name: "ì™„ë„", lon: 126.7226}, {name: "ì§„ë„", lon: 126.2635}, {name: "ì‹ ì•ˆ", lon: 126.1105}, {name: "í¬í•­", lon: 129.3435}, 
            {name: "ê²½ì£¼", lon: 129.2247}, {name: "ê¹€ì²œ", lon: 128.1189}, {name: "ì•ˆë™", lon: 128.7297}, {name: "êµ¬ë¯¸", lon: 128.3510}, 
            {name: "ì˜ì£¼", lon: 128.6250}, {name: "ì˜ì²œ", lon: 128.9385}, {name: "ìƒì£¼", lon: 128.1591}, {name: "ë¬¸ê²½", lon: 128.1993}, 
            {name: "ê²½ì‚°", lon: 128.7540}, {name: "êµ°ìœ„", lon: 128.5728}, {name: "ì˜ì„±", lon: 128.6974}, {name: "ì²­ì†¡", lon: 129.0572}, 
            {name: "ì˜ì–‘", lon: 129.1148}, {name: "ì˜ë•", lon: 129.3653}, {name: "ì²­ë„", lon: 128.7340}, {name: "ê³ ë ¹", lon: 128.2632}, 
            {name: "ì„±ì£¼", lon: 128.2854}, {name: "ì¹ ê³¡", lon: 128.4067}, {name: "ì˜ˆì²œ", lon: 128.5170}, {name: "ë´‰í™”", lon: 128.7351}, 
            {name: "ìš¸ì§„", lon: 129.4013}, {name: "ìš¸ë¦‰", lon: 130.9060}, {name: "ë…ë„", lon: 131.8696}, {name: "ì°½ì›", lon: 128.6811}, 
            {name: "ì§„ì£¼", lon: 128.0848}, {name: "í†µì˜", lon: 128.4285}, {name: "ì‚¬ì²œ", lon: 128.0707}, {name: "ê¹€í•´", lon: 128.8893}, 
            {name: "ë°€ì–‘", lon: 128.7483}, {name: "ê±°ì œ", lon: 128.6211}, {name: "ì–‘ì‚°", lon: 129.0373}, {name: "ì˜ë ¹", lon: 128.2618}, 
            {name: "í•¨ì•ˆ", lon: 128.4065}, {name: "ì°½ë…•", lon: 128.4921}, {name: "ê³ ì„±(ê²½ë‚¨)", lon: 128.3220}, {name: "ë‚¨í•´", lon: 127.8926}, 
            {name: "í•˜ë™", lon: 127.7515}, {name: "ì‚°ì²­", lon: 127.8735}, {name: "í•¨ì–‘", lon: 127.7252}, {name: "ê±°ì°½", lon: 127.9095}, 
            {name: "í•©ì²œ", lon: 128.1658}, {name: "ì œì£¼", lon: 126.5312}, {name: "ì„œê·€í¬", lon: 126.5601}
        ];

        // 2. ì´ˆê¸° ë¡œë”© ë° ì§€ì—­ ëª©ë¡ ì±„ìš°ê¸°
        window.onload = function() {
            // ë¼ì´ë¸ŒëŸ¬ë¦¬ ì²´í¬
            if(typeof Solar === 'undefined') {
                alert('âš ï¸ ê³„ì‚° ë„êµ¬(Lunar.js) ë¡œë”© ì‹¤íŒ¨!\në„¤íŠ¸ì›Œí¬ ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
                return;
            }

            const sel = document.getElementById('location');
            sel.innerHTML = '<option value="">ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            // ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
            LOCATIONS.sort((a, b) => a.name.localeCompare(b.name));
            LOCATIONS.forEach((loc, idx) => {
                let opt = document.createElement('option');
                opt.value = idx; 
                opt.text = loc.name;
                sel.add(opt);
            });
        };

        // 3. ê· ì‹œì°¨(EOT) ê³„ì‚° (ì§„íƒœì–‘ì‹œ í•µì‹¬)
        function getEquationOfTime(date) {
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = date - start;
            const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
            const B = (2 * Math.PI / 365) * (dayOfYear - 81);
            // ê³µì‹: 9.87 sin(2B) - 7.53 cos(B) - 1.5 sin(B) (ë¶„ ë‹¨ìœ„)
            return 9.87 * Math.sin(2 * B) - 7.53 * Math.cos(B) - 1.5 * Math.sin(B);
        }

        // 4. ì˜¤í–‰ ìƒ‰ìƒ ë§¤í•‘
        function getElementClass(char) {
            if("ç”²ä¹™å¯…å¯".includes(char)) return "wood";
            if("ä¸™ä¸å·³åˆ".includes(char)) return "fire";
            if("æˆŠå·±è¾°æˆŒä¸‘æœª".includes(char)) return "earth";
            if("åºšè¾›ç”³é…‰".includes(char)) return "metal";
            if("å£¬ç™¸äº¥å­".includes(char)) return "water";
            return "";
        }

        // 5. ë©”ì¸ ê³„ì‚° í•¨ìˆ˜
        function calculateSaju() {
            try {
                // ì…ë ¥ í™•ì¸
                const bDate = document.getElementById('bDate').value;
                const bTime = document.getElementById('bTime').value;
                const locIdx = document.getElementById('location').value;
                const gender = document.getElementById('gender').value;

                if(bDate.length !== 8) return alert("ìƒë…„ì›”ì¼ 8ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: 19941007)");
                if(bTime.length !== 4) return alert("ì¶œìƒì‹œê°„ 4ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: 1430)");
                if(locIdx === "") return alert("ì¶œìƒì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");

                const year = parseInt(bDate.substring(0, 4));
                const month = parseInt(bDate.substring(4, 6));
                const day = parseInt(bDate.substring(6, 8));
                const hour = parseInt(bTime.substring(0, 2));
                const minute = parseInt(bTime.substring(2, 4));

                // ----------------------------------------------------
                // [ì •ë°€ ì§„íƒœì–‘ì‹œ ë³´ì •]
                // 1. ê²½ë„ ë³´ì •: (ê²½ë„ - 135) * 4
                const location = LOCATIONS[document.getElementById('location').selectedIndex - 1]; // option 0ì€ ì•ˆë‚´ë¬¸êµ¬ë¼ì„œ -1 ë³´ì • í•„ìš”í•  ìˆ˜ ìˆìŒ. 
                // ì•ˆì „í•˜ê²Œ value(idx)ë¡œ ì°¾ê¸°:
                const realLoc = LOCATIONS[locIdx];
                
                const lonOffset = (realLoc.lon - 135) * 4;
                
                // 2. ê· ì‹œì°¨ ë³´ì •
                const baseDate = new Date(year, month - 1, day, hour, minute);
                const eotOffset = getEquationOfTime(baseDate);

                // 3. ìµœì¢… ì‹œê°„
                let adjDate = new Date(baseDate.getTime());
                adjDate.setMinutes(adjDate.getMinutes() + lonOffset + eotOffset);
                // ----------------------------------------------------

                // ë¼ì´ë¸ŒëŸ¬ë¦¬ ê³„ì‚°
                const lunar = Lunar.fromDate(adjDate);
                const baZi = lunar.getEightChar();

                // í™”ë©´ ì¶œë ¥ í—¬í¼
                const setCell = (idG, idJ, gan, ji) => {
                    const elG = document.getElementById(idG);
                    const elJ = document.getElementById(idJ);
                    elG.innerText = gan; elG.className = "gan " + getElementClass(gan);
                    elJ.innerText = ji; elJ.className = "ji " + getElementClass(ji);
                };

                // ì‚¬ì£¼ íŒ”ì ì¶œë ¥
                setCell('siGan', 'siJi', baZi.getTimeGan(), baZi.getTimeZhi());
                setCell('ilGan', 'ilJi', baZi.getDayGan(), baZi.getDayZhi());
                setCell('wolGan', 'wolJi', baZi.getMonthGan(), baZi.getMonthZhi());
                setCell('yeonGan', 'yeonJi', baZi.getYearGan(), baZi.getYearZhi());

                // ëŒ€ìš´ ê³„ì‚°
                const genderNum = (gender === "ë‚¨") ? 1 : 0;
                const yun = baZi.getYun(genderNum);
                const dirStr = yun.getGender() === 1 ? "ìˆœí–‰" : "ì—­í–‰";

                document.getElementById('daeunInfo').innerHTML = 
                    `<b>${yun.getStartAge()}</b>ì„¸ ë§ˆë‹¤ ëŒ€ìš´ì´ ë°”ë€ë‹ˆë‹¤ (${dirStr})`;

                // ëŒ€ìš´ ë¦¬ìŠ¤íŠ¸
                const listDiv = document.getElementById('daeunList');
                listDiv.innerHTML = "";
                yun.getDaYun().forEach((dy, i) => {
                    if(i >= 10) return;
                    const gan = dy.getGanZhi()[0];
                    const ji = dy.getGanZhi()[1];
                    const div = document.createElement('div');
                    div.className = "daeun-card";
                    div.innerHTML = `<div class="daeun-age">${dy.getStartAge()}ì„¸</div><div style="font-size:18px"><span class="${getElementClass(gan)}">${gan}</span><br><span class="${getElementClass(ji)}">${ji}</span></div>`;
                    listDiv.appendChild(div);
                });

                // ì„¸ìš´ (ì˜¬í•´)
                const thisYearLunar = Lunar.fromDate(new Date());
                const tyGan = thisYearLunar.getYearGan();
                const tyJi = thisYearLunar.getYearZhi();
                document.getElementById('seunInfo').innerHTML = `ì˜¬í•´ëŠ” <b class="${getElementClass(tyGan)}">${tyGan}</b><b class="${getElementClass(tyJi)}">${tyJi}</b>ë…„ ì…ë‹ˆë‹¤.`;

                // ê²°ê³¼ì°½ ë³´ì´ê¸°
                document.getElementById('resultArea').style.display = 'block';

            } catch (e) {
                alert("ì—ëŸ¬ ë°œìƒ: " + e.message);
                console.error(e);
            }
        }
    </script>
</body>
</html>